<div class="register add-new-custom-field-details">
  <div class="">
    <div class="mx-auto" style="max-width:  80rem;">
      <h5 class="add-new-custom-field-title border-bottom pb-3 mb-3">
        <span class="icon-container">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M9.58325 9.16699H7.08325" stroke="#414651" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
            <path d="M12.0833 5.83301H7.08325" stroke="#414651" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
            <path d="M16.6666 17.917V3.33366C16.6666 2.41318 15.9204 1.66699 14.9999 1.66699H4.99992C4.07944 1.66699 3.33325 2.41318 3.33325 3.33366V17.917L6.66659 16.2503L9.99992 18.3337L13.3333 16.2503L16.6666 17.917Z" stroke="#414651" stroke-width="1.5" stroke-linejoin="round"></path>
          </svg>
        </span>
        Invoices
      </h5>
      <table id="invoices-table" class="table table-condensed mobile-data">
        <thead>
          <tr>
            <th>Number</th>
            <th>Date</th>
            <th>Amount</th>
            <th>Balance</th>
            <th>Payment</th>
          </tr>
          </thead>
          <tbody>
          <tr>
            <td colspan="1" class="dataTables_empty">Loading data from server</td>
          </tr>
        </tbody>
      </table>
      <div id="deposit_amount_mismatch" class="text-danger">
        Warning! Total amount doesn't match deposit.
      </div>
    </div>
  </div>
</div>


<%= javascript_tag do %>
$(document).ready(function() {
  var table = $('#invoices-table').DataTable({
    "dom": "t",
    "paging": false,
    "ajax": "<%= account_invoices_path :format => :json %>",
    "processing": true,
    "serverSide": true,
    "search": {"search": $('#account_id').val()},
    "columnDefs": [
        {
          "targets": [ 4 ],
          "orderable": false
        }
      ],
    createdRow: function(row, data, dataIndex) {
      $('td', row).eq(4).html('<input class="payment_amount_invoice form-control invoice-table-input" type="number" name="payment_amount_' + data[0] + '" id="payment_amount_' + dataIndex + '" step="any" value="0">')
    },
    drawCallback: function() {
      $('input').change(function() {
        var table = $('#invoices-table').DataTable();
        var total = 0;
        table.rows().every(function (rowIdx, tableLoop, rowLoop) {
          var d = this.data();
          total += parseFloat($('#payment_amount_' + rowIdx).val(), 10);
        });
        if (total != parseFloat($('#payment_amount').val(), 10)) {
          $('#deposit_amount_mismatch').css('visibility', 'visible');
          $('#submit-btn').prop('disabled', true);
        } else {
          $('#deposit_amount_mismatch').css('visibility', 'hidden');
          $('#submit-btn').prop('disabled', false);
        }
      });
    }
  });
});
<% end %>
